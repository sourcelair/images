#! /bin/bash


set -ex

export DOCKER_REGISTRY_HOST=${DOCKER_REGISTRY_HOST:-registry.digitalocean.com/sourcelair}
export DOCKER_BUILDKIT=1

DOCKER_IMAGE_NAME=$1
DOCKER_IMAGE_TAG=$(git describe --always --abbrev=8)
DOCKER_IMAGE_DIRECTORY=images/${DOCKER_IMAGE_NAME}

echo "Push image ${DOCKER_IMAGE_NAME}:${DOCKER_IMAGE_TAG}"

cd ${DOCKER_IMAGE_DIRECTORY}

DOCKER_IMAGE_LOCAL=${DOCKER_IMAGE_NAME}:${DOCKER_IMAGE_TAG}
DOCKER_IMAGE_REMOTE=${DOCKER_REGISTRY_HOST}/${DOCKER_IMAGE_LOCAL}

docker push ${DOCKER_IMAGE_REMOTE}
